{% extends "scoreai/base.html" %}
{% load static %}
{% load humanize %}
{% load custom_filters %}

{% block title %}
{{ title }}
{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'scoreai/js/chart_colors.js' %}"></script>
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12 mb-4">
    <h4 class="fw-semibold mb-0">予算管理</h4>
    <p class="text-muted mb-0">予算の作成、管理、実績との比較分析を行います。</p>
  </div>
</div>

<!-- タブナビゲーション -->
<div class="row mb-4">
  <div class="col-12">
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link" href="{% url 'budget_suggest' %}" role="tab">
          <i class="ti ti-sparkles me-1"></i>AI予算策定（年次）
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" href="{% url 'budget_suggest_month' %}" role="tab">
          <i class="ti ti-sparkles me-1"></i>AI予算策定（月次）
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" href="{% url 'budget_analysis' %}" role="tab">
          <i class="ti ti-chart-pie me-1"></i>予算分析
        </a>
      </li>
    </ul>
  </div>
</div>

<!-- タブコンテンツ -->
<div class="tab-content" id="budgetTabsContent">
  <!-- 予算vs実績比較（年次） -->
  <div class="tab-pane fade show active" id="budget-vs-actual-yearly" role="tabpanel">
    <div class="row mb-3">
      <div class="col-12">
        <div class="alert alert-light border">
          <i class="ti ti-info-circle me-2 text-primary"></i>
          <strong>予算vs実績比較（年次）</strong>では、選択した年度の予算と実績を比較して表示できます。
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12 mb-3">
        <div class="d-flex align-items-center justify-content-end gap-2 flex-wrap">
          <form method="get" class="d-flex gap-2">
            <select name="year" class="form-select form-select-sm" onchange="this.form.submit()">
              {% for y in available_years %}
                <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}年</option>
              {% endfor %}
            </select>
          </form>
        </div>
      </div>
    </div>

{% if budget_year or actual_year %}
<div class="row">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">予算実績比較（{{ year }}年）</h5>
      </div>
      <div class="card-body">
        {% if budget_year and actual_year %}
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead class="table-light">
              <tr>
                <th>項目</th>
                <th class="text-end">予算</th>
                <th class="text-end">実績</th>
                <th class="text-end">差異</th>
                <th class="text-end">差異率</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>売上高</strong></td>
                <td class="text-end">{{ budget_year.sales|intcomma }}</td>
                <td class="text-end">{{ actual_year.sales|intcomma }}</td>
                <td class="text-end {% if actual_year.sales > budget_year.sales %}text-success{% else %}text-danger{% endif %}">
                  {{ actual_year.sales|subtract:budget_year.sales|intcomma }}
                </td>
                <td class="text-end {% if actual_year.sales > budget_year.sales %}text-success{% else %}text-danger{% endif %}">
                  {% if budget_year.sales > 0 %}
                    {{ actual_year.sales|subtract:budget_year.sales|divide:budget_year.sales|multiply:100|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>営業利益</strong></td>
                <td class="text-end">{{ budget_year.operating_profit|intcomma }}</td>
                <td class="text-end">{{ actual_year.operating_profit|intcomma }}</td>
                <td class="text-end {% if actual_year.operating_profit > budget_year.operating_profit %}text-success{% else %}text-danger{% endif %}">
                  {{ actual_year.operating_profit|subtract:budget_year.operating_profit|intcomma }}
                </td>
                <td class="text-end {% if actual_year.operating_profit > budget_year.operating_profit %}text-success{% else %}text-danger{% endif %}">
                  {% if budget_year.operating_profit > 0 %}
                    {{ actual_year.operating_profit|subtract:budget_year.operating_profit|divide:budget_year.operating_profit|multiply:100|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>経常利益</strong></td>
                <td class="text-end">{{ budget_year.ordinary_profit|intcomma }}</td>
                <td class="text-end">{{ actual_year.ordinary_profit|intcomma }}</td>
                <td class="text-end {% if actual_year.ordinary_profit > budget_year.ordinary_profit %}text-success{% else %}text-danger{% endif %}">
                  {{ actual_year.ordinary_profit|subtract:budget_year.ordinary_profit|intcomma }}
                </td>
                <td class="text-end {% if actual_year.ordinary_profit > budget_year.ordinary_profit %}text-success{% else %}text-danger{% endif %}">
                  {% if budget_year.ordinary_profit > 0 %}
                    {{ actual_year.ordinary_profit|subtract:budget_year.ordinary_profit|divide:budget_year.ordinary_profit|multiply:100|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>当期純利益</strong></td>
                <td class="text-end">{{ budget_year.net_profit|intcomma }}</td>
                <td class="text-end">{{ actual_year.net_profit|intcomma }}</td>
                <td class="text-end {% if actual_year.net_profit > budget_year.net_profit %}text-success{% else %}text-danger{% endif %}">
                  {{ actual_year.net_profit|subtract:budget_year.net_profit|intcomma }}
                </td>
                <td class="text-end {% if actual_year.net_profit > budget_year.net_profit %}text-success{% else %}text-danger{% endif %}">
                  {% if budget_year.net_profit > 0 %}
                    {{ actual_year.net_profit|subtract:budget_year.net_profit|divide:budget_year.net_profit|multiply:100|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="alert alert-warning">
          {% if not budget_year %}
            <i class="ti ti-alert-triangle me-2"></i>{{ year }}年の予算データが見つかりません。
          {% endif %}
          {% if not actual_year %}
            <i class="ti ti-alert-triangle me-2"></i>{{ year }}年の実績データが見つかりません。
          {% endif %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% if budget_year and actual_year and bs_indicators %}
<!-- BS比較 -->
<div class="row mt-4">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0 fw-semibold">貸借対照表比較（{{ year }}年）</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="table-light">
              <tr>
                <th>項目</th>
                <th class="text-end">予算</th>
                <th class="text-end">実績</th>
                <th class="text-end">差異（金額）</th>
                <th class="text-end">差異率</th>
              </tr>
            </thead>
            <tbody>
              <tr class="table-secondary">
                <td colspan="5"><strong>【資産の部】</strong></td>
              </tr>
              <tr>
                <td><strong>現金及び預金</strong></td>
                <td class="text-end">{{ bs_indicators.cash_and_deposits.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.cash_and_deposits.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.cash_and_deposits.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {{ bs_indicators.cash_and_deposits.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.cash_and_deposits.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {% if bs_indicators.cash_and_deposits.budget != 0 %}
                    {{ bs_indicators.cash_and_deposits.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>売上債権</strong></td>
                <td class="text-end">{{ bs_indicators.accounts_receivable.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.accounts_receivable.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.accounts_receivable.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {{ bs_indicators.accounts_receivable.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.accounts_receivable.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {% if bs_indicators.accounts_receivable.budget != 0 %}
                    {{ bs_indicators.accounts_receivable.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>棚卸資産</strong></td>
                <td class="text-end">{{ bs_indicators.inventory.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.inventory.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.inventory.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {{ bs_indicators.inventory.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.inventory.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {% if bs_indicators.inventory.budget != 0 %}
                    {{ bs_indicators.inventory.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>流動資産合計</strong></td>
                <td class="text-end">{{ bs_indicators.total_current_assets.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.total_current_assets.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.total_current_assets.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {{ bs_indicators.total_current_assets.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.total_current_assets.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {% if bs_indicators.total_current_assets.budget != 0 %}
                    {{ bs_indicators.total_current_assets.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>固定資産合計</strong></td>
                <td class="text-end">{{ bs_indicators.total_fixed_assets.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.total_fixed_assets.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.total_fixed_assets.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {{ bs_indicators.total_fixed_assets.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.total_fixed_assets.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {% if bs_indicators.total_fixed_assets.budget != 0 %}
                    {{ bs_indicators.total_fixed_assets.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr class="table-info">
                <td><strong>資産の部合計</strong></td>
                <td class="text-end"><strong>{{ bs_indicators.total_assets.budget|intcomma }}</strong></td>
                <td class="text-end"><strong>{{ bs_indicators.total_assets.actual|intcomma }}</strong></td>
                <td class="text-end {% if bs_indicators.total_assets.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  <strong>{{ bs_indicators.total_assets.diff|intcomma }}</strong>
                </td>
                <td class="text-end {% if bs_indicators.total_assets.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {% if bs_indicators.total_assets.budget != 0 %}
                    <strong>{{ bs_indicators.total_assets.diff_rate|floatformat:2 }}%</strong>
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr class="table-secondary">
                <td colspan="5"><strong>【負債の部】</strong></td>
              </tr>
              <tr>
                <td><strong>仕入債務</strong></td>
                <td class="text-end">{{ bs_indicators.accounts_payable.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.accounts_payable.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.accounts_payable.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  {{ bs_indicators.accounts_payable.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.accounts_payable.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  {% if bs_indicators.accounts_payable.budget != 0 %}
                    {{ bs_indicators.accounts_payable.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>短期借入金</strong></td>
                <td class="text-end">{{ bs_indicators.short_term_loans_payable.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.short_term_loans_payable.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.short_term_loans_payable.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  {{ bs_indicators.short_term_loans_payable.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.short_term_loans_payable.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  {% if bs_indicators.short_term_loans_payable.budget != 0 %}
                    {{ bs_indicators.short_term_loans_payable.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>流動負債合計</strong></td>
                <td class="text-end">{{ bs_indicators.total_current_liabilities.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.total_current_liabilities.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.total_current_liabilities.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  {{ bs_indicators.total_current_liabilities.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.total_current_liabilities.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  {% if bs_indicators.total_current_liabilities.budget != 0 %}
                    {{ bs_indicators.total_current_liabilities.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>長期借入金</strong></td>
                <td class="text-end">{{ bs_indicators.long_term_loans_payable.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.long_term_loans_payable.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.long_term_loans_payable.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  {{ bs_indicators.long_term_loans_payable.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.long_term_loans_payable.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  {% if bs_indicators.long_term_loans_payable.budget != 0 %}
                    {{ bs_indicators.long_term_loans_payable.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr class="table-info">
                <td><strong>負債の部合計</strong></td>
                <td class="text-end"><strong>{{ bs_indicators.total_liabilities.budget|intcomma }}</strong></td>
                <td class="text-end"><strong>{{ bs_indicators.total_liabilities.actual|intcomma }}</strong></td>
                <td class="text-end {% if bs_indicators.total_liabilities.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  <strong>{{ bs_indicators.total_liabilities.diff|intcomma }}</strong>
                </td>
                <td class="text-end {% if bs_indicators.total_liabilities.diff >= 0 %}text-danger{% else %}text-success{% endif %}">
                  {% if bs_indicators.total_liabilities.budget != 0 %}
                    <strong>{{ bs_indicators.total_liabilities.diff_rate|floatformat:2 }}%</strong>
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr class="table-secondary">
                <td colspan="5"><strong>【純資産の部】</strong></td>
              </tr>
              <tr>
                <td><strong>資本金</strong></td>
                <td class="text-end">{{ bs_indicators.capital_stock.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.capital_stock.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.capital_stock.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {{ bs_indicators.capital_stock.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.capital_stock.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {% if bs_indicators.capital_stock.budget != 0 %}
                    {{ bs_indicators.capital_stock.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><strong>利益剰余金</strong></td>
                <td class="text-end">{{ bs_indicators.retained_earnings.budget|intcomma }}</td>
                <td class="text-end">{{ bs_indicators.retained_earnings.actual|intcomma }}</td>
                <td class="text-end {% if bs_indicators.retained_earnings.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {{ bs_indicators.retained_earnings.diff|intcomma }}
                </td>
                <td class="text-end {% if bs_indicators.retained_earnings.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {% if bs_indicators.retained_earnings.budget != 0 %}
                    {{ bs_indicators.retained_earnings.diff_rate|floatformat:2 }}%
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              <tr class="table-info">
                <td><strong>純資産の部合計</strong></td>
                <td class="text-end"><strong>{{ bs_indicators.total_net_assets.budget|intcomma }}</strong></td>
                <td class="text-end"><strong>{{ bs_indicators.total_net_assets.actual|intcomma }}</strong></td>
                <td class="text-end {% if bs_indicators.total_net_assets.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  <strong>{{ bs_indicators.total_net_assets.diff|intcomma }}</strong>
                </td>
                <td class="text-end {% if bs_indicators.total_net_assets.diff >= 0 %}text-success{% else %}text-danger{% endif %}">
                  {% if bs_indicators.total_net_assets.budget != 0 %}
                    <strong>{{ bs_indicators.total_net_assets.diff_rate|floatformat:2 }}%</strong>
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- BSグラフ -->
<div class="row mt-4">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0 fw-semibold">貸借対照表比較グラフ</h5>
      </div>
      <div class="card-body">
        <canvas id="bsChart" height="80"></canvas>
      </div>
    </div>
  </div>
</div>
{% endif %}

{% if budget_monthly and actual_monthly %}
<div class="row mt-4">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">月次比較（{{ year }}年）</h5>
      </div>
      <div class="card-body">
        <canvas id="monthlyComparisonChart" height="100"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">月次比較表</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead class="table-light">
              <tr>
                <th>月度</th>
                <th class="text-end">予算売上高</th>
                <th class="text-end">実績売上高</th>
                <th class="text-end">差異</th>
                <th class="text-end">予算営業利益</th>
                <th class="text-end">実績営業利益</th>
                <th class="text-end">差異</th>
              </tr>
            </thead>
            <tbody>
              {% for comp in monthly_comparison %}
                <tr>
                  <td>{{ comp.display_month }}月</td>
                  <td class="text-end">{{ comp.budget_month.sales|floatformat:0|intcomma }}</td>
                  <td class="text-end">{{ comp.actual_month.sales|floatformat:0|intcomma }}</td>
                  <td class="text-end {% if comp.actual_month.sales > comp.budget_month.sales %}text-success{% else %}text-danger{% endif %}">
                    {{ comp.actual_month.sales|subtract:comp.budget_month.sales|floatformat:0|intcomma }}
                  </td>
                  <td class="text-end">{{ comp.budget_month.operating_profit|floatformat:0|intcomma }}</td>
                  <td class="text-end">{{ comp.actual_month.operating_profit|floatformat:0|intcomma }}</td>
                  <td class="text-end {% if comp.actual_month.operating_profit > comp.budget_month.operating_profit %}text-success{% else %}text-danger{% endif %}">
                    {{ comp.actual_month.operating_profit|subtract:comp.budget_month.operating_profit|floatformat:0|intcomma }}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const monthlyData = {
  labels: [{% for label in monthly_labels %}'{{ label }}'{% if not forloop.last %},{% endif %}{% endfor %}],
  budget: [
    {% for period in "123456789101112"|make_list %}
      {% with period_num=period|add:0 %}
        {% for budget_month in budget_monthly %}
          {% if budget_month.period == period_num %}{{ budget_month.sales }}{% endif %}
        {% empty %}0{% endfor %}
        {% if not forloop.last %},{% endif %}
      {% endwith %}
    {% endfor %}
  ],
  actual: [
    {% for period in "123456789101112"|make_list %}
      {% with period_num=period|add:0 %}
        {% for actual_month in actual_monthly %}
          {% if actual_month.period == period_num %}{{ actual_month.sales }}{% endif %}
        {% empty %}0{% endfor %}
        {% if not forloop.last %},{% endif %}
      {% endwith %}
    {% endfor %}
  ]
};

const ctx = document.getElementById('monthlyComparisonChart').getContext('2d');
new Chart(ctx, {
  type: 'line',
  data: {
    labels: monthlyData.labels,
    datasets: [
      {
        label: '予算',
        data: monthlyData.budget,
        borderColor: 'rgb(93, 135, 255)',
        backgroundColor: 'rgba(93, 135, 255, 0.1)',
        tension: 0.4,
      },
      {
        label: '実績',
        data: monthlyData.actual,
        borderColor: 'rgb(255, 99, 132)',
        backgroundColor: 'rgba(255, 99, 132, 0.1)',
        tension: 0.4,
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        position: 'top',
      }
    },
    scales: {
      y: {
        beginAtZero: true
      }
    }
  }
});
{% endif %}

{% if budget_year and actual_year and bs_indicators %}
<script>
// BSグラフ
const bsChartData = {{ bs_chart_data_json|safe }};
const bsCtx = document.getElementById('bsChart').getContext('2d');
new Chart(bsCtx, {
  type: 'bar',
  data: {
    labels: bsChartData.labels,
    datasets: [
      {
        label: '予算',
        data: bsChartData.budget,
        backgroundColor: 'rgba(93, 135, 255, 0.6)',
        borderColor: 'rgb(93, 135, 255)',
        borderWidth: 1,
      },
      {
        label: '実績',
        data: bsChartData.actual,
        backgroundColor: 'rgba(255, 99, 132, 0.6)',
        borderColor: 'rgb(255, 99, 132)',
        borderWidth: 1,
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: true,
    plugins: {
      legend: {
        position: 'top',
      },
      tooltip: {
        callbacks: {
          label: function(context) {
            return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + '千円';
          }
        }
      }
    },
    scales: {
      y: {
        beginAtZero: false,
        ticks: {
          callback: function(value) {
            return value.toLocaleString() + '千円';
          }
        }
      }
    }
  }
});
</script>
{% endif %}

{% else %}
<div class="row">
  <div class="col-lg-12">
    <div class="alert alert-info">
      <i class="ti ti-info-circle me-2"></i>
      予算または実績データが見つかりません。先にデータを登録してください。
    </div>
  </div>
</div>
{% endif %}
{% endblock %}


