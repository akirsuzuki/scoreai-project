{% extends "scoreai/base.html" %}
{% load static %}
{% load humanize %}
{% load custom_filters %}

{% block title %}
{{ title }}
{% endblock %}

{% block head %}
 <!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/3.0.2/css/responsive.dataTables.css">
<link rel="stylesheet" href="https://cdn.datatables.net/fixedcolumns/4.3.0/css/fixedColumns.dataTables.css">
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/responsive/3.0.2/js/dataTables.responsive.js"></script>
<script src="https://cdn.datatables.net/fixedcolumns/4.3.0/js/dataTables.fixedColumns.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'scoreai/js/chart_colors.js' %}"></script>

<style>
  @media print {
    .page-break {
      page-break-before: always;
      margin-top: 2em;
    }
    .app-header {
      display: none;
    }
  }
</style>

{% endblock %}

{% block breadcrumb %}
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12 mb-4">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
      <h4 class="fw-semibold mb-0">借入管理</h4>
      <div class="d-flex gap-2 flex-wrap">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="ti ti-download me-1"></i>エクスポート
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{% url 'export_debts' 'csv' %}">
              <i class="ti ti-file-text me-2"></i>CSV形式
            </a></li>
            <li><a class="dropdown-item" href="{% url 'export_debts' 'excel' %}">
              <i class="ti ti-file-spreadsheet me-2"></i>Excel形式
            </a></li>
            <li><a class="dropdown-item" href="{% url 'export_debts' 'pdf' %}">
              <i class="ti ti-file-type-pdf me-2"></i>PDF形式
            </a></li>
          </ul>
        </div>
        <a href="{% url 'debts_all' %}" class="btn btn-primary btn-sm">借入一覧</a>
        <a href="{% url 'debts_byBank' %}" class="btn btn-outline-primary btn-sm">金融機関別</a>
        <a href="{% url 'debts_bySecuredType' %}" class="btn btn-outline-primary btn-sm">保証別</a>
        <a href="{% url 'debts_archived' %}" class="btn btn-outline-primary btn-sm">アーカイブ済み</a>
      </div>
    </div>
  </div>
</div>
<p id="dashboard"></p>
{% include 'scoreai/debt_dashboard.html' %}

<p id="alldebts"></p>
{% include 'scoreai/debt_list_active.html' %}

<p id="finished"></p>
{% include 'scoreai/debt_list_finished.html' %}

<p id="rescheduled"></p>
{% include 'scoreai/debt_list_rescheduled.html' %}
{% include 'scoreai/debt_list_chart.html' %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Update the selector to include all three tables
    const tables = ['active_debt_list', 'rescheduled_debt_list', 'completed_debt_list'];
    
    tables.forEach(tableId => {
      const rows = document.querySelectorAll(`#${tableId} tbody tr`);
      rows.forEach(row => {
        row.addEventListener('click', function () {
          const href = this.getAttribute('data-href');
          if (href) {
            window.location.href = href;
          }
        });
      });
    });
  });
</script>




{% endblock %}