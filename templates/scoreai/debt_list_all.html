{% extends "scoreai/base.html" %}
{% load static %}
{% load humanize %}
{% load custom_filters %}

{% block title %}
{{ title }}
{% endblock %}

{% block head %}
<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css">
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'scoreai/js/chart_colors.js' %}"></script>
<style>
  /* DataTablesのオーバーフロー防止 */
  div.dt-container {
    width: 100% !important;
    overflow-x: auto;
  }
  table.dataTable {
    width: 100% !important;
  }
  /* 小計行のスタイル */
  .subtotal-row {
    background-color: #f8f9fa !important;
    font-weight: bold;
  }
  .subtotal-row:hover {
    background-color: #e9ecef !important;
  }
  .subtotal-row td {
    border-top: 2px solid #dee2e6;
    border-bottom: 2px solid #dee2e6;
  }
</style>
{% endblock %}

{% block breadcrumb %}
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12 mb-4">
    <h4 class="fw-semibold mb-0">借入管理</h4>
    <p class="text-muted mb-0">借入情報の管理と分析を行います。</p>
  </div>
</div>

<!-- タブナビゲーション -->
<div class="row mb-4">
  <div class="col-12">
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link" href="{% url 'debts_overview' %}" role="tab">
          <i class="ti ti-chart-pie me-1"></i>概要
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link active" href="{% url 'debts_all' %}" role="tab">
          <i class="ti ti-list me-1"></i>借入一覧
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" href="{% url 'debts_byBank' %}" role="tab">
          <i class="ti ti-building-bank me-1"></i>金融機関別
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" href="{% url 'debts_bySecuredType' %}" role="tab">
          <i class="ti ti-shield me-1"></i>保証別
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" href="{% url 'debts_archived' %}" role="tab">
          <i class="ti ti-archive me-1"></i>アーカイブ済み
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" href="{% url 'debt_create' %}" role="tab">
          <i class="ti ti-plus me-1"></i>新規登録
        </a>
      </li>
    </ul>
  </div>
</div>

<!-- タブコンテンツ -->
<div class="tab-content" id="debtTabsContent">
  <!-- 借入一覧 -->
  <div class="tab-pane fade show active" id="debt-list" role="tabpanel">
    <div class="row mb-3">
      <div class="col-12">
        <div class="alert alert-light border">
          <i class="ti ti-info-circle me-2 text-primary"></i>
          <strong>借入一覧</strong>では、すべての借入情報を一覧で確認できます。
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12 mb-3">
        <div class="d-flex align-items-center justify-content-end gap-2 flex-wrap">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="ti ti-download me-1"></i>エクスポート
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="{% url 'export_debts' 'csv' %}">
                <i class="ti ti-file-text me-2"></i>CSV形式
              </a></li>
              <li><a class="dropdown-item" href="{% url 'export_debts' 'excel' %}">
                <i class="ti ti-file-spreadsheet me-2"></i>Excel形式
              </a></li>
              <li><a class="dropdown-item" href="{% url 'export_debts' 'pdf' %}">
                <i class="ti ti-file-type-pdf me-2"></i>PDF形式
              </a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <p id="alldebts"></p>
    {% include 'scoreai/debt_list_active.html' %}
    {% include 'scoreai/debt_list_chart.html' %}

    <p id="finished"></p>
    {% include 'scoreai/debt_list_finished.html' %}

    <p id="rescheduled"></p>
    {% include 'scoreai/debt_list_rescheduled.html' %}

  </div><!-- /.tab-pane -->
</div><!-- /.tab-content -->

{% endblock %}