{% load django_bootstrap5 %}
{% load static %}

<!doctype html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    {% block title %}
    {% endblock %}
  </title>
  {% block head %}
  {% endblock %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="shortcut icon" type="image/png" href="{% static 'scoreai/img/FaviconSCore_Ai.png' %}" />
  <link rel="stylesheet" href="{% static 'Modernize-1.0.0/src/assets/css/styles.min.css' %}" />
  <script src="https://kit.fontawesome.com/c0e97851db.js" crossorigin="anonymous"></script>
  <script src="{% static 'scoreai/js/sidebars.js' %}"></script>
  <link rel="stylesheet" href="{% static 'scoreai/css/variables.css' %}" />
  <link rel="stylesheet" href="{% static 'scoreai/css/custom.css' %}" />
  <link rel="stylesheet" href="{% static 'scoreai/css/sidebars.css' %}" />
  <link rel="stylesheet" href="{% static 'scoreai/css/loading.css' %}" />
</head>

<body>
  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full" data-sidebar-position="fixed" data-header-position="fixed">
    <!-- Sidebar -->
    {% include 'scoreai/base-sidebar.html' %}
    <!--  Main wrapper -->
    <div class="body-wrapper">
      <!--  Body Header -->
      {% include 'scoreai/base-header.html' %}

      <div class="container-fluid">
        {% if show_title_card|default_if_none:False %}
        <div class="card bg-info-subtle shadow-none position-relative mb-4">
          <div class="card-body px-4 py-4">
            <div class="row align-items-center">
              <div class="col-12">
                <h4 class="fw-semibold mb-0">{% if title and title|length > 0 %}{{ title }}{% else %}ページタイトル{% endif %}</h4>
                {% block breadcrumb %}
                {% endblock %}
              </div>
            </div>
          </div>
        </div>
        {% endif %}



        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div 
                class="alert alert-dismissible fade show
                       {% if message.tags == 'error' %}alert-danger
                       {% elif message.tags == 'success' %}alert-success
                       {% else %}alert-warning
                       {% endif %}" 
                role="alert">
                {% if 'safe' in message.tags %}
                    {{ message|safe }}
                {% else %}
                    {{ message }}
                {% endif %}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

      {% block content %}

      {% endblock %}
      
      <!-- コピーライトのみ表示 -->
      <div class="text-center py-3 mt-4">
        <p class="mb-0" style="font-size: 12px; color: #5A6A85;">
          © 2024 <a href="https://vancreworth.com/" target="_blank" style="color: #5D87FF; text-decoration: none;">VanCrewworth CO.,LTD.</a>
        </p>
      </div>
      </div>

    </div>
  </div>

  <!-- <script src="{% static 'Modernize-1.0.0/src/assets/libs/jquery/dist/jquery.min.js' %}"></script> -->
  <script src="{% static 'Modernize-1.0.0/src/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'Modernize-1.0.0/src/assets/js/sidebarmenu.js' %}"></script>
  <script src="{% static 'Modernize-1.0.0/src/assets/js/app.min.js' %}"></script>
  <script src="{% static 'Modernize-1.0.0/src/assets/libs/simplebar/dist/simplebar.js' %}"></script>
  <script src="{% static 'scoreai/js/loading.js' %}"></script>
  <script>
    // ページ読み込み後にアクティブなメニュー項目までスクロール
    document.addEventListener('DOMContentLoaded', function() {
      // sidebarmenu.jsが実行された後に実行されるように少し待つ
      setTimeout(function() {
        // アクティブなメニュー項目を検索
        const activeMenuItem = document.querySelector('#sidebarnav .sidebar-link.active, #sidebarnav .sidebar-item.selected .sidebar-link');
        
        if (activeMenuItem) {
          // 親のcollapseメニューを展開
          const collapseMenu = activeMenuItem.closest('.collapse');
          if (collapseMenu && !collapseMenu.classList.contains('show') && !collapseMenu.classList.contains('in')) {
            const collapseTrigger = document.querySelector(`[data-bs-target="#${collapseMenu.id}"], [href="#${collapseMenu.id}"]`);
            if (collapseTrigger) {
              // Bootstrap 5のcollapseを展開
              const bsCollapse = new bootstrap.Collapse(collapseMenu, {
                toggle: false
              });
              bsCollapse.show();
            }
          }
          
          // collapseのアニメーションを待ってからスクロール
          setTimeout(function() {
            // SimpleBarのスクロールコンテナを取得
            const sidebarNav = document.querySelector('.sidebar-nav[data-simplebar]');
            if (sidebarNav) {
              // SimpleBarのインスタンスを取得
              const simpleBarInstance = SimpleBar.instances.get(sidebarNav);
              if (simpleBarInstance) {
                // アクティブな項目の位置を取得
                const activeItemRect = activeMenuItem.getBoundingClientRect();
                const sidebarRect = sidebarNav.getBoundingClientRect();
                
                // スクロール位置を計算（アクティブ項目が中央付近に来るように）
                const scrollContainer = simpleBarInstance.getScrollElement();
                const itemOffsetTop = activeMenuItem.offsetTop;
                const sidebarHeight = sidebarNav.clientHeight;
                const targetScrollTop = itemOffsetTop - (sidebarHeight / 2) + (activeItemRect.height / 2);
                
                // スムーズにスクロール
                scrollContainer.scrollTo({
                  top: Math.max(0, targetScrollTop),
                  behavior: 'smooth'
                });
              } else {
                // SimpleBarインスタンスが取得できない場合、直接スクロール
                const scrollContainer = sidebarNav.querySelector('.simplebar-content-wrapper');
                if (scrollContainer) {
                  const itemOffsetTop = activeMenuItem.offsetTop;
                  const sidebarHeight = sidebarNav.clientHeight;
                  const targetScrollTop = itemOffsetTop - (sidebarHeight / 2);
                  
                  scrollContainer.scrollTo({
                    top: Math.max(0, targetScrollTop),
                    behavior: 'smooth'
                  });
                }
              }
            } else {
              // SimpleBarが使われていない場合、通常のスクロール
              activeMenuItem.scrollIntoView({
                behavior: 'smooth',
                block: 'center',
                inline: 'nearest'
              });
            }
          }, 350); // collapseのアニメーション時間を考慮
        }
      }, 100); // sidebarmenu.jsの実行を待つ
    });
  </script>
  <!-- <script src="{% static 'Modernize-1.0.0/src/assets/js/dashboard.js' %}"></script> -->
  <!-- <script src="{% static 'Modernize-1.0.0/src/assets/libs/simplebar/src/simplebar.js' %}"></script> -->

</body>
{% block foot %}
{% endblock %}
</html>