{% load static %}
{% load custom_tags %}
{% load plan_features_tags %}
<!-- Sidebar Start -->
<aside class="left-sidebar">
  <!-- Sidebar scroll-->
  <div class="sidebar-inner">
    <div class="brand-logo d-flex align-items-center justify-content-between">
      <a href="{% url 'index' %}" class="pencil-logo-text">
        <span class="pencil-logo-main">SCore</span>
        <span class="pencil-logo-accent">_Ai</span>
      </a>
      <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
        <i class="ti ti-x fs-8"></i>
      </div>
    </div>
    <!-- Sidebar navigation-->
    <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
      <ul id="sidebarnav">
        <!-- ========================================
             セクション1: Home
             ======================================== -->
        <li class="nav-small-cap">
          <span class="hide-menu">Home</span>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'index' %}" aria-expanded="false" title="ダッシュボード">
            <i class="ti ti-dashboard"></i>
            <span class="hide-menu">ダッシュボード</span>
          </a>
        </li>

        <!-- ========================================
             セクション2: AI相談
             ======================================== -->
        <li class="nav-small-cap">
          <span class="hide-menu">AI相談</span>
        </li>
        <li class="sidebar-item ai-consultation-center">
          <a class="sidebar-link" href="{% url 'ai_consultation_center' %}" aria-expanded="false" title="AI相談センター">
            <i class="ti ti-message-circle"></i>
            <span class="hide-menu">AI相談センター</span>
          </a>
        </li>

        <!-- ========================================
             セクション3: 財務管理
             ======================================== -->
        <li class="nav-small-cap">
          <span class="hide-menu">財務管理</span>
        </li>
        <!-- 月次PL -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'fiscal_summary_month_list' %}?years=3" aria-expanded="false" title="月次PL">
            <i class="ti ti-calendar"></i>
            <span class="hide-menu">月次PL</span>
          </a>
        </li>
        <!-- 年次財務諸表 -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'fiscal_summary_year_list' %}?is_draft=false" aria-expanded="false" title="年次財務諸表">
            <i class="ti ti-file-text"></i>
            <span class="hide-menu">年次財務諸表</span>
          </a>
        </li>
        <!-- 予算管理 -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'budget_analysis' %}" aria-expanded="false" title="予算管理">
            <i class="ti ti-chart-bar"></i>
            <span class="hide-menu">予算管理</span>
          </a>
        </li>
        <!-- 借入管理 -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'debts_overview' %}" aria-expanded="false" title="借入管理">
            <i class="ti ti-credit-card"></i>
            <span class="hide-menu">借入管理</span>
          </a>
        </li>
        <!-- 株主情報 -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'stakeholder_name_list' %}" aria-expanded="false" title="株主情報">
            <i class="ti ti-users"></i>
            <span class="hide-menu">株主情報</span>
          </a>
        </li>
        <!-- ノート（議事録） -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'meeting_minutes_list' %}" aria-expanded="false" title="ノート（議事録）">
            <i class="ti ti-notes"></i>
            <span class="hide-menu">ノート（議事録）</span>
          </a>
        </li>
        <!-- To Do -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'todo_list' %}" aria-expanded="false" title="To Do">
            <i class="ti ti-checkbox"></i>
            <span class="hide-menu">To Do</span>
          </a>
        </li>
        <!-- ローカルベンチマーク -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'industry_benchmark_list' %}" aria-expanded="false" title="ローカルベンチマーク">
            <i class="ti ti-chart-line"></i>
            <span class="hide-menu">ローカルベンチマーク</span>
          </a>
        </li>

        <!-- ========================================
             セクション4: データ取り込み
             ======================================== -->
        <li class="nav-small-cap">
          <span class="hide-menu">データ取り込み</span>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'import_fiscal_summary_month' %}" aria-expanded="false" title="CSV取り込み">
            <i class="ti ti-file-upload"></i>
            <span class="hide-menu">CSV取り込み</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'import_fiscal_summary_ocr' %}" aria-expanded="false" title="OCR読み込み">
            <i class="ti ti-scan"></i>
            <span class="hide-menu">OCR読み込み</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'financial_report' %}" aria-expanded="false" title="財務会議資料生成">
            <i class="ti ti-file-spreadsheet"></i>
            <span class="hide-menu">財務会議資料生成</span>
          </a>
        </li>

        <!-- ========================================
             セクション5: 設定
             ======================================== -->
        <li class="nav-small-cap">
          <span class="hide-menu">設定</span>
        </li>
        <!-- プロフィール（全ユーザー共通） -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'user_profile' %}" aria-expanded="false" title="プロフィール">
            <i class="ti ti-user"></i>
            <span class="hide-menu">プロフィール</span>
          </a>
        </li>
        <!-- 会社設定（選択中のCompanyがある場合） -->
        {% get_user_selected_company user as selected_company %}
        {% if selected_company %}
        {% get_user_company user selected_company as user_company %}
        <!-- 会社詳細（Company Userのみ、is_manager=Trueの場合のみ編集可能） -->
        {% if user.is_company_user and user_company and user_company.is_manager %}
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'company_detail' id=selected_company.id %}" aria-expanded="false" title="会社詳細">
            <i class="ti ti-building"></i>
            <span class="hide-menu">会社詳細</span>
          </a>
        </li>
        <!-- 会社メンバー管理（Company Userのみ、is_manager=Trueの場合のみ） -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'company_member_list' company_id=selected_company.id %}" aria-expanded="false" title="会社メンバー管理">
            <i class="ti ti-users-group"></i>
            <span class="hide-menu">会社メンバー管理</span>
          </a>
        </li>
        {% endif %}
        <!-- マイスクリプト（選択中のCompanyがある場合） -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'user_ai_script_list' %}" aria-expanded="false" title="マイスクリプト">
            <i class="ti ti-script"></i>
            <span class="hide-menu">マイスクリプト</span>
          </a>
        </li>
        <!-- クラウドストレージ（選択中のCompanyがある場合） -->
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'storage_setting' %}" aria-expanded="false" title="クラウドストレージ">
            <i class="ti ti-cloud"></i>
            <span class="hide-menu">クラウドストレージ</span>
          </a>
        </li>
        {% endif %}

        <!-- ========================================
             セクション6: Firm管理（Firm Ownerのみ）
             ======================================== -->
        {% get_user_firm_owner user as user_firm_owner %}
        {% if user_firm_owner %}
        <li class="nav-small-cap">
          <span class="hide-menu">Firm管理</span>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'firm_settings' firm_id=user_firm_owner.firm.id %}" aria-expanded="false" title="Firm設定">
            <i class="ti ti-building-community"></i>
            <span class="hide-menu">Firm設定</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'firm_company_register' %}" aria-expanded="false" title="顧客企業登録">
            <i class="ti ti-building-plus"></i>
            <span class="hide-menu">顧客企業登録</span>
          </a>
        </li>
        {% endif %}

        <!-- ========================================
             セクション7: コンサルタント（Firm Userのみ）
             ======================================== -->
        {% if user.is_financial_consultant %}
        <li class="nav-small-cap">
          <span class="hide-menu">コンサルタント</span>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'assigned_clients_list' %}" aria-expanded="false" title="アサイン一覧">
            <i class="ti ti-list"></i>
            <span class="hide-menu">アサイン一覧</span>
          </a>
        </li>
        {% endif %}

        <!-- ========================================
             セクション8: 管理者機能（Superuserのみ）
             ======================================== -->
        {% if user.is_superuser %}
        <li class="nav-small-cap">
          <span class="hide-menu">管理者機能</span>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'admin_ai_script_list' %}" aria-expanded="false" title="AIスクリプト管理（システム）">
            <i class="ti ti-settings"></i>
            <span class="hide-menu">AIスクリプト管理</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'admin:index' %}" aria-expanded="false" target="_blank" title="Django管理画面">
            <i class="ti ti-shield"></i>
            <span class="hide-menu">Django管理画面</span>
          </a>
        </li>
        {% endif %}
      </ul>
    </nav>
    <!-- Sidebar Footer (Pencil Design System chRNO) -->
    <div class="sidebar-footer">
      <div class="sidebar-footer-user">
        <div class="sidebar-footer-user-info">
          <span class="sidebar-footer-username">{{ user.username }}</span>
          <span class="sidebar-footer-email">{{ user.email }}</span>
        </div>
      </div>
      <!-- SCore_AIについて -->
      <div class="sidebar-footer-about">
        <a href="{% url 'about_links' %}" class="sidebar-footer-about-link" title="SCore_AIについて">
          <i class="ti ti-info-circle"></i>
          <span>SCore_AIについて</span>
        </a>
      </div>
    </div>
  </div>
</aside>
