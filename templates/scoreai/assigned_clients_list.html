{% extends "scoreai/base.html" %}
{% load static %}
{% load humanize %}

{% block title %}
{{ title }}
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12 mb-4">
    <h4 class="fw-semibold mb-0">コンサルタント機能</h4>
    <p class="text-muted mb-0">コンサルタントとしての機能を管理します。</p>
  </div>
</div>

<!-- タブナビゲーション -->
<div class="row mb-4">
  <div class="col-12">
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link active" href="{% url 'assigned_clients_list' %}" role="tab">
          <i class="ti ti-list me-1"></i>アサイン一覧
        </a>
      </li>
    </ul>
  </div>
</div>

<!-- タブコンテンツ -->
<div class="tab-content" id="clientTabsContent">
  <!-- アサイン済みクライアント -->
  <div class="tab-pane fade show active" id="assigned-clients" role="tabpanel">
    <div class="row mb-3">
      <div class="col-12">
        <div class="alert alert-light border">
          <i class="ti ti-info-circle me-2 text-primary"></i>
          <strong>アサイン済みクライアント</strong>では、自分にアサインされているクライアントを確認できます。
        </div>
      </div>
    </div>

<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title fw-semibold mb-0">アサインされているクライアント</h5>
      </div>
      <div class="card-body p-4">
        {% if assigned_clients %}
        <div class="table-responsive">
          <table class="table text-nowrap mb-0 align-middle">
            <thead class="text-dark fs-4">
              <tr>
                <th class="border-bottom-0">
                  <h6 class="fw-semibold mb-0">会社名</h6>
                </th>
                <th class="border-bottom-0">
                  <h6 class="fw-semibold mb-0">会計年度</h6>
                </th>
                <th class="border-bottom-0">
                  <h6 class="fw-semibold mb-0">有効User数</h6>
                </th>
                <th class="border-bottom-0">
                  <h6 class="fw-semibold mb-0">操作</h6>
                </th>
              </tr>
            </thead>
            <tbody>
              {% for client in assigned_clients %}
              <tr>
                <td class="border-bottom-0">
                  <h6 class="fw-semibold mb-1">{{ client.company.name }}</h6>
                </td>
                <td class="border-bottom-0">
                  <p class="mb-0 fw-normal">{{ client.company.fiscal_month }}月</p>
                </td>
                <td class="border-bottom-0">
                  <p class="mb-0 fw-normal">{{ client.company.user_count }}</p>
                </td>
                <td class="border-bottom-0">
                  <div class="d-flex align-items-center gap-2">
                    {% if not client.is_selected %}
                    <a href="{% url 'select_company' client.company.id %}" 
                       class="btn btn-sm btn-primary" 
                       title="選択">
                      <i class="ti ti-check me-1"></i>選択
                    </a>
                    {% else %}
                    <span class="badge bg-success">選択中</span>
                    {% endif %}
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-4">
          <i class="ti ti-users-off" class="pencil-empty-icon"></i>
          <p class="text-muted mt-3 mb-0">アサインされているクライアントがありません</p>
        </div>
        {% endif %}
      </div>
      <div class="card-footer">
        <button type="button" onclick="history.back()" class="btn btn-outline-secondary">戻る</button>
      </div>
    </div>
  </div>
</div>
  </div>  <!-- Close .tab-pane -->
</div>  <!-- Close .tab-content -->
{% endblock %}

