<div class="card d-flex flex-column h-100">
  <div class="card-header">
    <h5 class="card-title fw-semibold"> 保証別残高 </h5>
  </div>
  <div class="card-body">
    <div class="d-flex justify-content-center pencil-chart-container">
      <canvas id="chart_bySecured" class="pencil-chart"></canvas>
    </div>
  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('chart_bySecured').getContext('2d');
    const data = {
      labels: [
        {% for debt in debt_list_bySecuredType %}
    '{{ debt.secured_type }}'{% if not forloop.last %}, {% endif %}
    {% endfor %}
      ],
    datasets: [{
      data: [
        {% for debt in debt_list_bySecuredType %}
            {{ debt.balances_monthly.0 }}{% if not forloop.last %}, {% endif %}
  {% endfor %}
        ],
  backgroundColor: [
    'rgb(255, 99, 132)',
    'rgb(54, 162, 235)',
    'rgb(255, 205, 86)',
    'rgb(75, 192, 192)',
    'rgb(153, 102, 255)',
    'rgb(201, 203, 207)'
  ],
    hoverOffset: 4
      }]
    };
  const config = {
    type: 'bar',
    data: data,
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false,
        },
        tooltip: {
          backgroundColor: '#FFFFFF',
          titleColor: '#0F0F0F',
          bodyColor: '#0F0F0F',
          borderColor: '#E0E0E0',
          borderWidth: 1,
          padding: 12,
          titleFont: {
            family: "'Noto Serif JP', 'Cormorant Garamond', serif",
            size: 13,
            weight: '600'
          },
          bodyFont: {
            family: "'Noto Sans Mono CJK JP', 'JetBrains Mono', monospace",
            size: 12,
            weight: '500'
          },
          displayColors: true,
          boxPadding: 4,
          cornerRadius: 0,
          callbacks: {
            label: function(context) {
              let label = context.label || '';
              if (label) {
                label += ': ';
              }
              if (context.parsed.y !== null) {
                label += context.parsed.y.toLocaleString('ja-JP') + ' 千円';
              }
              return label;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            color: '#E0E0E0',
            lineWidth: 1,
            drawBorder: false
          },
          ticks: {
            font: {
              family: "'Noto Sans Mono CJK JP', 'JetBrains Mono', monospace",
              size: 11,
              weight: '500'
            },
            color: '#666666',
            padding: 8,
            callback: function(value) {
              return value.toLocaleString('ja-JP');
            }
          }
        },
        x: {
          grid: {
            display: false,
            drawBorder: false
          },
          ticks: {
            font: {
              family: "'Noto Sans JP', 'Inter', sans-serif",
              size: 11,
              weight: '500'
            },
            color: '#666666',
            padding: 8
          }
        }
      },
      elements: {
        bar: {
          borderRadius: 0,
          borderSkipped: false
        }
      },
      animation: {
        duration: 600,
        easing: 'easeOutQuart'
      }
    },
  };
  new Chart(ctx, config);
  });
</script>