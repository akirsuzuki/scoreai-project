# プラン管理機能 クイックスタートガイド

## 1. サーバーの起動

```bash
docker compose exec django python manage.py runserver 0.0.0.0:8000
```

または、バックグラウンドで起動：

```bash
docker compose up -d django
```

## 2. テスト用Firmの作成

```bash
docker compose exec django python manage.py create_test_firm
```

出力例：
```
Firm ID: 01KDHGX8MB5GNY9W4B3928MB5D
プラン一覧URL: http://localhost:8000/plans/01KDHGX8MB5GNY9W4B3928MB5D/
```

## 3. 動作確認

### 3.1 プラン一覧ページ

1. ブラウザで `http://localhost:8000/plans/<firm_id>/` にアクセス
2. 4つのプランが表示されることを確認
3. 各プランの料金と機能制限が正しく表示されることを確認

### 3.2 プラン詳細ページ

1. 任意のプランの「詳細を見る」ボタンをクリック
2. プランの詳細情報が表示されることを確認
3. 「このプランに登録」ボタンが表示されることを確認

### 3.3 Freeプランの登録

1. Freeプランの詳細ページにアクセス
2. 「無料で登録」ボタンをクリック
3. サブスクリプション管理ページにリダイレクトされることを確認
4. ステータスが「試用期間中」になっていることを確認

### 3.4 サブスクリプション管理ページ

1. `http://localhost:8000/plans/<firm_id>/subscription/` にアクセス
2. 現在のプラン情報が表示されることを確認
3. 利用状況（AI相談回数、OCR回数）が表示されることを確認
4. 管理しているCompany数が表示されることを確認

### 3.5 サイドバーの確認

1. ログイン後、サイドバーに「プラン・サブスクリプション」リンクが表示されることを確認（Firmオーナーのみ）
2. リンクをクリックしてプラン一覧ページに遷移できることを確認

## 4. トラブルシューティング

### エラー: `ModuleNotFoundError: No module named 'stripe'`
```bash
docker compose exec django pip install stripe
```

### エラー: `このFirmのオーナー権限がありません`
- テスト用Firmを作成してください（上記の手順2を参照）
- または、既存のFirmでオーナー権限があることを確認してください

### エラー: テンプレートが見つからない
- テンプレートファイルが正しく作成されているか確認してください
- サーバーを再起動してください

## 5. 次のステップ

動作確認が完了したら、以下を実装します：

1. **Stripe Webhook処理**: 支払い状況の自動更新
2. **利用状況の自動追跡**: AI相談・OCR使用時のカウント
3. **月次リセット機能**: 毎月1日に利用回数をリセット

