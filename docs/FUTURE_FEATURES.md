# 実装予定機能一覧

## 概要

SCORE AIプロジェクトで今後実装予定の機能をまとめています。優先度と実装時期を考慮して整理しています。

## 目次

1. [クラウドストレージ連携](#クラウドストレージ連携)
2. [OCR機能の拡張](#ocr機能の拡張)
3. [パフォーマンス最適化](#パフォーマンス最適化)
4. [テストコードの拡充](#テストコードの拡充)
5. [会計ソフト連携の拡張](#会計ソフト連携の拡張)
6. [レポート・エクスポート機能](#レポートエクスポート機能)
7. [通知機能](#通知機能)
8. [その他の機能](#その他の機能)

---

## クラウドストレージ連携

### 現状
- ✅ **Google Drive**: 実装済み（OAuth認証、フォルダ作成、ファイルアップロード、ダウンロード）

### 実装予定

#### 1. Box連携 🔴 高優先度
- **概要**: Box APIを使用したクラウドストレージ連携
- **実装内容**:
  - Box OAuth2認証の実装
  - `BoxAdapter`クラスの作成（`scoreai/utils/storage/box.py`）
  - フォルダ作成・ファイルアップロード・ダウンロード機能
  - トークン管理とリフレッシュ機能
- **参考**: [Box API ドキュメント](https://developer.box.com/)
- **依存関係**: `boxsdk` パッケージの追加が必要

#### 2. Dropbox連携 🔴 高優先度
- **概要**: Dropbox APIを使用したクラウドストレージ連携
- **実装内容**:
  - Dropbox OAuth2認証の実装
  - `DropboxAdapter`クラスの作成（`scoreai/utils/storage/dropbox.py`）
  - フォルダ作成・ファイルアップロード・ダウンロード機能
  - トークン管理とリフレッシュ機能
- **参考**: [Dropbox API ドキュメント](https://www.dropbox.com/developers/documentation)
- **依存関係**: `dropbox` パッケージの追加が必要

#### 3. OneDrive連携 🔴 高優先度
- **概要**: Microsoft Graph APIを使用したOneDrive連携
- **実装内容**:
  - Microsoft OAuth2認証の実装
  - `OneDriveAdapter`クラスの作成（`scoreai/utils/storage/onedrive.py`）
  - フォルダ作成・ファイルアップロード・ダウンロード機能
  - トークン管理とリフレッシュ機能
- **参考**: [Microsoft Graph API ドキュメント](https://learn.microsoft.com/en-us/graph/api/resources/onedrive)
- **依存関係**: `msal` パッケージの追加が必要

### 実装方針
- すべてのストレージアダプターは`StorageAdapter`ベースクラスを継承
- 共通インターフェースを維持し、ストレージ間の切り替えを容易に
- OAuth認証フローは各ストレージサービスに合わせて実装
- トークンの暗号化保存を検討（セキュリティ強化）

---

## OCR機能の拡張

### 現状
- ✅ **決算書OCR**: 実装済み（Google Cloud Vision API使用）
- ✅ **金銭消費貸借契約書OCR**: 実装済み

### 実装予定

#### 1. その他の契約書OCR 🟡 中優先度
- **概要**: リース契約書、商品売買契約、賃貸借契約などのOCR対応
- **実装内容**:
  - 各契約書タイプに応じたパースロジックの追加
  - 契約書専用モデルの作成（必要に応じて）
  - テンプレート変数の追加
- **優先度**: 中（既存のOCR機能を拡張）

#### 2. 試算表OCR 🟡 中優先度
- **概要**: 試算表（貸借対照表、損益計算書、月次推移損益計算書、部門別損益計算書）のOCR対応
- **実装内容**:
  - 試算表の構造に応じたパースロジック
  - `FiscalSummary_Month`モデルへの自動保存
  - 月次データの自動インポート機能
- **優先度**: 中（CSVインポートが既に存在するため）

#### 3. OCR精度の向上 🟢 低優先度
- **概要**: OCR結果の精度向上とエラーハンドリングの改善
- **実装内容**:
  - 複数のOCRエンジンのサポート（必要に応じて）
  - 手動修正機能の追加
  - OCR結果の検証機能
- **優先度**: 低（現状の精度で十分な場合）

---

## パフォーマンス最適化

### 1. データベースインデックスの追加 🟡 中優先度
- **概要**: クエリパフォーマンスの向上のためのインデックス追加
- **実装内容**:
  - 頻繁に検索されるフィールドへのインデックス追加
  - 外部キーへのインデックス追加
  - 複合インデックスの検討
- **対象モデル**:
  - `Debt`（金融機関、保証タイプ、開始日など）
  - `FiscalSummary_Year`（年度、会社など）
  - `FiscalSummary_Month`（年度、月、会社など）
  - `AIConsultationHistory`（ユーザー、相談タイプ、作成日など）
  - `UploadedDocument`（ユーザー、ドキュメントタイプ、処理ステータスなど）
- **優先度**: 中（パフォーマンステスト後に実施）

### 2. キャッシング戦略の実装 🟡 中優先度
- **概要**: 頻繁にアクセスされるデータのキャッシング
- **実装内容**:
  - Redisキャッシュの導入（本番環境）
  - キャッシュキーの設計
  - キャッシュ無効化戦略
- **キャッシュ対象**:
  - 業界ベンチマークデータ
  - AI相談スクリプト（システムデフォルト）
  - ドキュメントフォルダ構造
  - ユーザー設定（頻繁に変更されないもの）
- **優先度**: 中（パフォーマンステスト後に実施）

### 3. クエリ最適化の継続 🟢 低優先度
- **概要**: N+1クエリ問題の継続的な監視と改善
- **実装内容**:
  - 定期的なクエリパフォーマンス監視
  - `select_related`と`prefetch_related`の最適化
  - クエリプロファイリングツールの導入
- **優先度**: 低（既に主要なN+1問題は解決済み）

---

## テストコードの拡充

### 現状
- ✅ 基本的なモデルテスト（`test_models.py`）
- ✅ 基本的なビューテスト（`test_views.py`）

### 実装予定

#### 1. 統合テストの追加 🟡 中優先度
- **概要**: エンドツーエンドの統合テスト
- **実装内容**:
  - CSVインポート機能の統合テスト
  - OCR機能の統合テスト
  - AI相談機能の統合テスト
  - クラウドストレージ連携の統合テスト
- **優先度**: 中

#### 2. APIテストの追加 🟡 中優先度
- **概要**: AI相談API、ストレージAPIなどのテスト
- **実装内容**:
  - `AIConsultationAPIView`のテスト
  - ストレージ接続テストのテスト
  - エラーハンドリングのテスト
- **優先度**: 中

#### 3. フォームバリデーションテスト 🟢 低優先度
- **概要**: フォームのバリデーションロジックのテスト
- **実装内容**:
  - 各フォームのバリデーションテスト
  - エラーメッセージのテスト
- **優先度**: 低

---

## 会計ソフト連携の拡張

### 現状
- ✅ **Money Forward CSVインポート**: 実装済み（月次PL、年次決算）

### 実装予定

#### 1. freee連携 🔴 高優先度
- **概要**: freee APIを使用した自動データ取得
- **実装内容**:
  - freee OAuth認証の実装
  - freee APIクライアントの作成
  - 決算書データの自動取得
  - 月次データの自動取得
- **参考**: [freee API ドキュメント](https://developer.freee.co.jp/)
- **優先度**: 高（ユーザー要望が多い）

#### 2. Money Forward API連携 🟡 中優先度
- **概要**: Money Forward APIを使用した自動データ取得（CSVインポートの代替）
- **実装内容**:
  - Money Forward OAuth認証の実装
  - Money Forward APIクライアントの作成
  - 決算書データの自動取得
- **参考**: [Money Forward API ドキュメント](https://developer.moneyforward.com/)
- **優先度**: 中（CSVインポートが既に存在するため）

#### 3. その他の会計ソフト連携 🟢 低優先度
- **概要**: その他の会計ソフト（弥生会計、マネーフォワード クラウド確定申告など）との連携
- **実装内容**:
  - 各ソフトのAPI連携
  - 統一インターフェースの設計
- **優先度**: 低（需要に応じて）

---

## レポート・エクスポート機能

### 実装予定

#### 1. PDFレポート生成 🟡 中優先度
- **概要**: 決算書データ、借入情報などをPDF形式でエクスポート
- **実装内容**:
  - PDF生成ライブラリの導入（`reportlab`または`weasyprint`）
  - レポートテンプレートの作成
  - カスタマイズ可能なレポート形式
- **優先度**: 中

#### 2. Excelエクスポート 🟡 中優先度
- **概要**: データをExcel形式でエクスポート
- **実装内容**:
  - `openpyxl`または`xlsxwriter`の使用
  - 決算書データのExcelエクスポート
  - 借入情報のExcelエクスポート
  - グラフを含むレポートの生成
- **優先度**: 中

#### 3. 定期レポート自動生成 🟢 低優先度
- **概要**: 月次・年次の定期レポート自動生成
- **実装内容**:
  - Django管理コマンドの作成
  - スケジューラー（Celery等）の導入
  - メール送信機能との連携
- **優先度**: 低

---

## 通知機能

### 実装予定

#### 1. メール通知 🟡 中優先度
- **概要**: 重要なイベントのメール通知
- **実装内容**:
  - Djangoメール機能の設定
  - 通知テンプレートの作成
  - 通知設定の管理機能
- **通知対象**:
  - データインポート完了
  - OCR処理完了
  - 重要な財務指標のアラート
- **優先度**: 中

#### 2. ブラウザ通知 🟢 低優先度
- **概要**: ブラウザ内での通知表示
- **実装内容**:
  - Web Push APIの実装
  - 通知設定の管理
- **優先度**: 低

---

## その他の機能

### 1. データバックアップ・復元機能 🟡 中優先度
- **概要**: データのバックアップと復元機能
- **実装内容**:
  - 定期バックアップの自動実行
  - バックアップファイルのダウンロード
  - 復元機能
- **優先度**: 中

### 2. データエクスポート・インポート機能 🟡 中優先度
- **概要**: 全データのエクスポート・インポート
- **実装内容**:
  - JSON形式でのエクスポート
  - エクスポートデータのインポート
  - データ移行機能
- **優先度**: 中

### 3. 多言語対応 🟢 低優先度
- **概要**: 英語などへの多言語対応
- **実装内容**:
  - Django i18nの設定
  - 翻訳ファイルの作成
  - 言語切り替え機能
- **優先度**: 低（現時点では日本語のみ）

### 4. モバイルアプリ 🟢 低優先度
- **概要**: iOS/Androidアプリの開発
- **実装内容**:
  - REST APIの拡張
  - モバイルアプリの開発
- **優先度**: 低（Webアプリが優先）

### 5. ダッシュボードのカスタマイズ 🟢 低優先度
- **概要**: ユーザーごとのダッシュボードカスタマイズ
- **実装内容**:
  - ウィジェットの追加・削除
  - レイアウトのカスタマイズ
  - お気に入り機能
- **優先度**: 低

---

## 実装優先度まとめ

### 🔴 高優先度（次期リリース予定）
1. Box連携
2. Dropbox連携
3. OneDrive連携
4. freee連携

### 🟡 中優先度（中期実装予定）
1. データベースインデックスの追加
2. キャッシング戦略の実装
3. 統合テストの追加
4. APIテストの追加
5. PDFレポート生成
6. Excelエクスポート
7. メール通知
8. データバックアップ・復元機能
9. データエクスポート・インポート機能

### 🟢 低優先度（長期実装予定）
1. その他の契約書OCR
2. 試算表OCR
3. OCR精度の向上
4. クエリ最適化の継続
5. フォームバリデーションテスト
6. Money Forward API連携
7. その他の会計ソフト連携
8. 定期レポート自動生成
9. ブラウザ通知
10. 多言語対応
11. モバイルアプリ
12. ダッシュボードのカスタマイズ

---

## 実装時の注意事項

### セキュリティ
- OAuthトークンの暗号化保存を検討
- APIキーの適切な管理
- データアクセス制御の強化

### パフォーマンス
- 大量データ処理時の最適化
- 非同期処理の検討（Celery等）
- キャッシュ戦略の適切な設計

### ユーザビリティ
- エラーメッセージの改善
- ローディング状態の表示
- レスポンシブデザインの維持

### 保守性
- コードの可読性とメンテナンス性
- ドキュメントの整備
- テストコードの充実

---

## 更新履歴

- 2024年12月28日: 初版作成

